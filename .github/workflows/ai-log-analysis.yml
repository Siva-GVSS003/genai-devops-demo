name: GenAI Log Analysis

on:
  workflow_dispatch:

jobs:
  ai-analyze:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: 3.11

      - name: Install dependencies
        run: pip install openai

      - name: Analyze logs using AI
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          python <<EOF
          import os
          import openai

          openai.api_key = os.getenv("OPENAI_API_KEY")

          with open("logs/k8s-error.log", "r") as f:
              log_data = f.read()

          prompt = f"""
          You are a senior DevOps engineer.
          Analyze the following Kubernetes error log and give:
          1. Root cause
          2. Troubleshooting steps
          3. Preventive actions

          LOG:
          {log_data}
          """

          response = openai.ChatCompletion.create(
              model="gpt-4",
              messages=[{"role": "user", "content": prompt}]
          )

          print("===== AI ANALYSIS =====")
          print(response.choices[0].message.content)
          EOF
